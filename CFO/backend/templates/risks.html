<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment - Spectre</title>
    <meta name="description" content="Comprehensive risk analysis with color-coded alerts and actionable insights.">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="layout-sidebar">
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main Navigation">
        <div class="container">
            <a href="index.html" class="navbar-brand" aria-label="AI CFO Assistant Home">
                Spectre
            </a>
            <ul class="navbar-nav">
                <li><a href="index.html">Home</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="upload.html">Upload</a></li>
                <li><a href="risks.html" class="active" aria-current="page">Risks</a></li>
                <li><a href="insights.html">Insights</a></li>
                <li><a href="monitoring.html">Monitoring</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content risks">
        <div class="container">
            <!-- Page Header -->
            <section class="mb-xl">
                <div class="d-flex" style="align-items: center; justify-content: space-between; flex-wrap: wrap; gap: var(--space-md);">
                    <div>
                        <h1>Risk Assessment</h1>
                        <p style="color: var(--text-secondary); margin: 0;">
                            AI-powered financial risk analysis with color-coded alerts and actionable recommendations
                        </p>
                    </div>
                    <div>
                        <span id="riskLastUpdated" style="color: var(--text-muted); font-size: var(--font-size-sm);">
                            Last updated: Loading...
                        </span>
                        <button class="btn btn-secondary ml-md" onclick="refreshRiskAnalysis()" aria-label="Refresh risk analysis">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <polyline points="23,4 23,10 17,10"/>
                                <polyline points="1,20 1,14 7,14"/>
                                <path d="m3.51,9a9,9 0 0 1 14.85-3.36L23,10M1,14l4.64,4.36A9,9 0 0 0 20.49,15"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Loading State -->
            <div id="riskLoadingState" class="text-center" style="padding: var(--space-2xl) 0;">
                <div class="spinner" style="width: 40px; height: 40px;"></div>
                <p class="mt-md">Analyzing financial risks...</p>
            </div>

            <!-- Risk Overview -->
            <div id="riskContent" class="d-none">
                <section class="mb-xl" aria-labelledby="risk-overview-title">
                    <h2 id="risk-overview-title" class="mb-lg">Risk Overview</h2>
                    <div class="grid grid-3" id="riskOverview">
                        <!-- Risk overview cards will be populated by JavaScript -->
                    </div>
                </section>

                <!-- Risk Alerts -->
                <section class="mb-xl" aria-labelledby="risk-alerts-title">
                    <h2 id="risk-alerts-title" class="mb-lg">Active Risk Alerts</h2>
                    <div id="riskAlerts">
                        <!-- Risk alerts will be populated by JavaScript -->
                    </div>
                </section>

                <!-- Risk Categories -->
                <section class="mb-xl" aria-labelledby="risk-categories-title">
                    <h2 id="risk-categories-title" class="mb-lg">Risk Categories</h2>
                    <div class="grid grid-2">
                        <!-- Financial Risks -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Financial Risks</h3>
                            </div>
                            <div class="card-body">
                                <div id="financialRisks">
                                    <!-- Financial risks will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Operational Risks -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Operational Risks</h3>
                            </div>
                            <div class="card-body">
                                <div id="operationalRisks">
                                    <!-- Operational risks will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Market Risks -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Market & External Risks</h3>
                            </div>
                            <div class="card-body">
                                <div id="marketRisks">
                                    <!-- Market risks will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Compliance Risks -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Compliance & Regulatory</h3>
                            </div>
                            <div class="card-body">
                                <div id="complianceRisks">
                                    <!-- Compliance risks will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Risk Mitigation Recommendations -->
                <section class="mb-xl" aria-labelledby="mitigation-title">
                    <h2 id="mitigation-title" class="mb-lg">Risk Mitigation Recommendations</h2>
                    <div id="mitigationRecommendations">
                        <!-- Mitigation recommendations will be populated here -->
                    </div>
                </section>

                <!-- Risk Trends -->
                <section aria-labelledby="risk-trends-title">
                    <h2 id="risk-trends-title" class="mb-lg">Risk Trends</h2>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Risk Score Over Time</h3>
                        </div>
                        <div class="card-body">
                            <div id="riskTrendChart" style="height: 300px; position: relative;">
                                <!-- Risk trend chart will be generated here -->
                            </div>
                            <div class="mt-md text-center">
                                <span style="font-size: var(--font-size-sm); color: var(--text-muted);">
                                    Risk assessment trends over the past 6 months
                                </span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Error State -->
            <div id="riskErrorState" class="d-none text-center" style="padding: var(--space-2xl) 0;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--danger-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: var(--space-lg);" aria-hidden="true">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <h3>Unable to Load Risk Analysis</h3>
                <p class="mb-lg" style="color: var(--text-secondary);">
                    We're unable to perform risk analysis at this time. This could be because no financial data has been uploaded yet, or there's a temporary connection issue.
                </p>
                <div class="d-flex" style="justify-content: center; gap: var(--space-md);">
                    <a href="upload.html" class="btn btn-primary">Upload Documents</a>
                    <button class="btn btn-secondary" onclick="refreshRiskAnalysis()">Try Again</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Risk Detail Modal -->
    <div id="riskDetailModal" class="d-none" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; display: none;" aria-hidden="true" role="dialog" aria-labelledby="risk-detail-title">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div class="card-header" style="position: sticky; top: 0; background: var(--bg-card); z-index: 1;">
                <div class="d-flex" style="align-items: center; justify-content: space-between;">
                    <h3 id="risk-detail-title" class="card-title mb-0">Risk Details</h3>
                    <button class="btn btn-secondary" onclick="closeRiskModal()" aria-label="Close modal" style="padding: var(--space-sm);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="card-body" id="riskDetailContent">
                <!-- Risk detail content will be populated here -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/utils.js" defer></script>
    <script src="js/api.js" defer></script>
    <script>
    (function() {
        try {
            var hasUploaded = !!localStorage.getItem('uploaded_graphs');
            var loading = document.getElementById('riskLoadingState');
            var content = document.getElementById('riskContent');
            var error = document.getElementById('riskErrorState');

            if (!hasUploaded) {
                // Show static page structure without running heavy analysis
                if (loading) loading.classList.add('d-none');
                if (error) error.classList.add('d-none');
                if (content) content.classList.remove('d-none');
            } else {
                if (loading) loading.classList.remove('d-none');
                if (error) error.classList.add('d-none');
            }

            if (hasUploaded) {
                var charts = document.createElement('script');
                charts.src = 'js/charts.js';
                charts.defer = true;
                document.body.appendChild(charts);

                var risks = document.createElement('script');
                risks.src = 'js/risks.js';
                risks.defer = true;
                document.body.appendChild(risks);
            }
        } catch (e) {
            // no-op
        }
    })();
    </script>
</body>
</html>