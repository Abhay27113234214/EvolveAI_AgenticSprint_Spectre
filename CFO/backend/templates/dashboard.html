<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Dashboard - Spectre</title>
    <meta name="description" content="Real-time financial dashboard showing key metrics, KPIs, and performance indicators.">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="layout-sidebar">
    <!-- Navigation -->
    <nav class="navbar" role="navigation" aria-label="Main Navigation">
        <div class="container">
            <a href="{{ url_for('index') }}" class="navbar-brand" aria-label="Spectre Home">
                Spectre
            </a>
            <ul class="navbar-nav">
                <li><a href="{{ url_for('index') }}">Home</a></li>
                <li><a href="{{ url_for('dashboard') }}" class="active" aria-current="page">Dashboard</a></li>
                <li><a href="{{ url_for('uploadAnnualPdf') }}">Upload</a></li>
                <li><a href="{{ url_for('index') }}#risks">Risks</a></li>
                <li><a href="{{ url_for('dashboard') }}#insights">Insights</a></li>
                <li><a href="{{ url_for('dashboard') }}#monitoring">Monitoring</a></li>
            </ul>
            <div style="margin-top:auto;"></div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content dashboard">
        <div class="container" style="position: relative;">
            <!-- Page Header -->
            <!-- Page Header -->
            <section class="mb-xl">
                <div class="d-flex" style="align-items: center; justify-content: space-between; flex-wrap: wrap; gap: var(--space-md);">
                    <div>
                        <h1>Financial Dashboard</h1>
                        <p style="color: var(--text-secondary); margin: 0;">
                            Real-time overview of your financial performance and key metrics
                        </p>
                    </div>
                    <div class="d-flex" style="align-items:center; gap: var(--space-md); position: relative;">
                        <span id="lastUpdated" style="color: var(--text-muted); font-size: var(--font-size-sm);">Last updated: Loading...</span>
                        <button id="refreshBtn" class="btn btn-secondary" aria-label="Refresh dashboard data" style="flex-shrink:0;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <polyline points="23,4 23,10 17,10"/>
                                <polyline points="1,20 1,14 7,14"/>
                                <path d="m3.51,9a9,9 0 0 1 14.85-3.36L23,10M1,14l4.64,4.36A9,9 0 0 0 20.49,15"/>
                            </svg>
                        </button>
                        <div class="profile-menu" id="profileMenu" style="position: relative;">
                            <img src="https://api.dicebear.com/7.x/identicon/svg?seed=Spectre" alt="Profile" class="profile-avatar" id="profileAvatar">
                            <div class="profile-dropdown" id="profileDropdown" role="menu" aria-hidden="true" style="right:0;">
                                <a href="{{ url_for('login') }}" id="logoutLink">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loading State -->
            <div id="loadingState" class="text-center" style="padding: var(--space-2xl) 0;">
                <div class="spinner" style="width: 40px; height: 40px;"></div>
                <p class="mt-md">Loading financial data...</p>
            </div>

            <!-- Main Dashboard Content -->
            <div id="dashboardContent" class="d-none">
                <div class="bento-grid">
                    <!-- KPIs full width -->
                    <section class="tile tile--kpis" aria-labelledby="kpi-title">
                        <h2 id="kpi-title" class="mb-lg">Key Performance Indicators</h2>
                        <div class="grid grid-4" id="kpiGrid"></div>
                    </section>

                    <!-- Cash Flow vs Burn (large) -->
                    <section class="tile tile--cash" aria-labelledby="charts-title">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Cash Flow vs Burn Rate</h3>
                            </div>
                            <div class="card-body">
                                <div id="cashFlowChart" style="height: 300px; position: relative;"></div>
                                <div class="mt-md" style="display: flex; justify-content: center; gap: var(--space-lg);">
                                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                        <div style="width: 12px; height: 12px; background-color: var(--success-color); border-radius: 50%;"></div>
                                        <span style="font-size: var(--font-size-sm);">Cash Inflow</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                                        <div style="width: 12px; height: 12px; background-color: var(--danger-color); border-radius: 50%;"></div>
                                        <span style="font-size: var(--font-size-sm);">Burn Rate</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Revenue Trend (tall) -->
                    <section class="tile tile--revenue">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Monthly Revenue Trend</h3>
                            </div>
                            <div class="card-body">
                                <div id="revenueChart" style="height: 300px; position: relative;"></div>
                                <div class="mt-md text-center">
                                    <span style="font-size: var(--font-size-sm); color: var(--text-muted);">Last 12 months performance</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Balance Sheet Overview (half) -->
                    <section class="tile tile--balance" aria-labelledby="summary-title">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Balance Sheet Overview</h3>
                            </div>
                            <div class="card-body">
                                <div id="balanceSheetData"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Actions (half) -->
                    <section class="tile tile--actions">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Quick Actions</h3>
                            </div>
                            <div class="card-body">
                                <div class="d-flex" style="flex-direction: column; gap: var(--space-md);">
                                    <a href="upload.html" class="btn btn-primary" aria-label="Upload new financial documents">Upload New Documents</a>
                                    <a href="risks.html" class="btn btn-warning" aria-label="View risk assessment">Assess Risks</a>
                                    <a href="insights.html" class="btn btn-success" aria-label="Chat with AI CFO">Ask AI CFO</a>
                                    <button id="exportBtn" class="btn btn-secondary" aria-label="Export financial data">Export Data</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Recent Activities full width -->
                    <section class="tile tile--activities" aria-labelledby="activities-title">
                        <h2 id="activities-title" class="mb-lg">Recent Financial Activities</h2>
                        <div class="card">
                            <div class="card-body">
                                <div id="recentActivities"></div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="d-none text-center" style="padding: var(--space-2xl) 0;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--danger-color)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: var(--space-lg);" aria-hidden="true">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <h3>Unable to Load Dashboard</h3>
                <p class="mb-lg" style="color: var(--text-secondary);">
                    We're having trouble loading your financial data. This could be because no documents have been uploaded yet, or there's a temporary connection issue.
                </p>
                <div class="d-flex" style="justify-content: center; gap: var(--space-md);">
                    <a href="upload.html" class="btn btn-primary">Upload Documents</a>
                    <button id="retryBtn" class="btn btn-secondary">Try Again</button>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="js/utils.js" defer></script>
    <script src="app.js" defer></script>
    <script defer>
    document.addEventListener('DOMContentLoaded', function() {
        const avatar = document.getElementById('profileAvatar');
        const dropdown = document.getElementById('profileDropdown');
        const logoutLink = document.getElementById('logoutLink');

        if (avatar && dropdown) {
            avatar.addEventListener('click', function(e) {
                e.stopPropagation();
                const isOpen = dropdown.style.display === 'block';
                dropdown.style.display = isOpen ? 'none' : 'block';
                dropdown.setAttribute('aria-hidden', isOpen ? 'true' : 'false');
            });

            document.addEventListener('click', function() {
                dropdown.style.display = 'none';
                dropdown.setAttribute('aria-hidden', 'true');
            });
        }

        if (logoutLink) {
            logoutLink.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.cfoAssistant) {
                    window.cfoAssistant.logout();
                } else {
                    localStorage.removeItem('cfo_token');
                    localStorage.removeItem('cfo_user');
                    window.location.href = 'index.html';
                }
            });
        }
    });
    </script>
</body>
</html>